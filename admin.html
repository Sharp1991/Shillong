<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FixMyCity - Admin Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { padding: 20px; }
    #dashboard { display: none; }
    .container { max-width: 1000px; margin: auto; }
  </style>
</head>
<body>

<div id="login">
  <div class="container text-center">
    <h1 class="mb-4">Admin Login</h1>
    <input type="password" id="adminPassword" class="form-control mb-3" placeholder="Enter admin password">
    <button id="loginBtn" class="btn btn-primary">Login</button>
    <p id="errorMsg" class="text-danger mt-2"></p>
  </div>
</div>

<div id="dashboard">
  <div class="container">
    <h1 class="mb-4">Admin Dashboard</h1>
    <table class="table table-bordered" id="reportTable">
      <thead>
        <tr>
          <th>ID</th>
          <th>Title</th>
          <th>Description</th>
          <th>Latitude</th>
          <th>Longitude</th>
          <th>Status</th>
          <th>Photo</th>
        </tr>
      </thead>
      <tbody>
        <!-- Rows will be inserted here by JS -->
      </tbody>
    </table>
  </div>
</div>

<script type="module">
  // Embedded password (change as needed)
  const ADMIN_PASSWORD = 'FixMyCity123';

  const loginDiv = document.getElementById('login');
  const dashboardDiv = document.getElementById('dashboard');
  const loginBtn = document.getElementById('loginBtn');
  const errorMsg = document.getElementById('errorMsg');

  loginBtn.addEventListener('click', () => {
    const input = document.getElementById('adminPassword').value;
    if(input === ADMIN_PASSWORD) {
      loginDiv.style.display = 'none';
      dashboardDiv.style.display = 'block';
      loadReports();
    } else {
      errorMsg.textContent = 'Incorrect password!';
    }
  });

  import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

  const supabaseUrl = 'https://kdjwrgcyhtrxfjvhonfh.supabase.co';
  const supabaseKey = 'sb_publishable_SqTmlMsLjOXafXiv1vwxcg_--j67cTK';
  const supabase = createClient(supabaseUrl, supabaseKey);

  async function loadReports() {
    const { data, error } = await supabase.from('report').select('*').order('id', { ascending: false });
    if(error) {
      alert('Error fetching reports: ' + error.message);
      return;
    }

    const tbody = document.querySelector('#reportTable tbody');
    tbody.innerHTML = '';
    data.forEach(report => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${report.id}</td>
        <td>${report.title}</td>
        <td>${report.description}</td>
        <td>${report.latitude}</td>
        <td>${report.longitude}</td>
        <td>${report.status}</td>
        <td>${report.photo_url ? `<a href="${report.photo_url}" target="_blank">View Photo</a>` : ''}</td>
      `;
      tbody.appendChild(tr);
    });
  }
</script>

</body>
</html>
