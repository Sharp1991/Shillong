<!-- Location -->
<div class="form-section">
  <h3 class="mb-4">Location</h3>
  <div class="mb-3">
    <label for="latitude" class="form-label fw-bold">Latitude</label>
    <input type="number" step="any" class="form-control" id="latitude" placeholder="Enter or click map" required>
  </div>
  <div class="mb-3">
    <label for="longitude" class="form-label fw-bold">Longitude</label>
    <input type="number" step="any" class="form-control" id="longitude" placeholder="Enter or click map" required>
  </div>
  <div class="mb-3">
    <label class="form-label fw-bold">Select Location on Map</label>
    <div id="locationMap" style="height:300px; border-radius:8px;"></div>
  </div>
</div>

<script type="module">
  import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'

  const supabaseUrl = 'https://kdjwrgcyhtrxfjvhonfh.supabase.co';
  const supabaseKey = 'YOUR_ANON_KEY'; // replace with your anon key
  const supabase = createClient(supabaseUrl, supabaseKey);

  // Initialize Map
  const locationMap = L.map('locationMap').setView([25.5788, 91.8933], 13);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: 'Â© OpenStreetMap contributors'
  }).addTo(locationMap);

  let locationMarker = null;

  // Click on map to set marker and fill fields
  locationMap.on('click', (e) => {
    const { lat, lng } = e.latlng;
    document.getElementById('latitude').value = lat.toFixed(6);
    document.getElementById('longitude').value = lng.toFixed(6);

    if(locationMarker) locationMap.removeLayer(locationMarker);
    locationMarker = L.marker([lat, lng]).addTo(locationMap);
  });

  // Update marker when user enters lat/lng manually
  function updateMarker() {
    const lat = parseFloat(document.getElementById('latitude').value);
    const lng = parseFloat(document.getElementById('longitude').value);

    if(!isNaN(lat) && !isNaN(lng)){
      if(locationMarker) locationMap.removeLayer(locationMarker);
      locationMarker = L.marker([lat, lng]).addTo(locationMap);
      locationMap.setView([lat, lng], 16);
    }
  }

  document.getElementById('latitude').addEventListener('input', updateMarker);
  document.getElementById('longitude').addEventListener('input', updateMarker);
</script>
